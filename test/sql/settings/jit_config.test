-- Test for SET enable_luajit_jit and current_setting()

-- Check default value
STATEMENT OK
SELECT current_setting('enable_luajit_jit');
----
false

-- Set to true
STATEMENT OK
SET enable_luajit_jit = true;

STATEMENT OK
SELECT current_setting('enable_luajit_jit');
----
true

-- Set to false
STATEMENT OK
SET enable_luajit_jit = false;

STATEMENT OK
SELECT current_setting('enable_luajit_jit');
----
false

-- Set to 'on' (string)
STATEMENT OK
SET enable_luajit_jit = 'on';

STATEMENT OK
SELECT current_setting('enable_luajit_jit');
----
true

-- Set to 'off' (string)
STATEMENT OK
SET enable_luajit_jit = 'off';

STATEMENT OK
SELECT current_setting('enable_luajit_jit');
----
false

-- Set to 1 (integer)
STATEMENT OK
SET enable_luajit_jit = 1;

STATEMENT OK
SELECT current_setting('enable_luajit_jit');
----
true

-- Set to 0 (integer)
STATEMENT OK
SET enable_luajit_jit = 0;

STATEMENT OK
SELECT current_setting('enable_luajit_jit');
----
false

-- Test invalid string value
STATEMENT ERROR
SET enable_luajit_jit = 'bla';
----
Binder Error: SET enable_luajit_jit: Could not convert string 'bla' to BOOLEAN

-- Test invalid numeric value (e.g., 2) - DuckDB's cast from int to bool is non-zero = true
STATEMENT OK
SET enable_luajit_jit = 2;

STATEMENT OK
SELECT current_setting('enable_luajit_jit');
----
true

-- Test scope (SESSION is default and should work)
STATEMENT OK
SET SESSION enable_luajit_jit = true;

STATEMENT OK
SELECT current_setting('enable_luajit_jit');
----
true

-- Test GLOBAL scope (should error)
STATEMENT ERROR
SET GLOBAL enable_luajit_jit = true;
----
Invalid Input Error: Cannot SET GLOBAL enable_luajit_jit. This setting is session-local.

-- Test RESET for enable_luajit_jit
STATEMENT OK
SET enable_luajit_jit = true; -- Change from default
RESET enable_luajit_jit;

STATEMENT OK
SELECT current_setting('enable_luajit_jit');
----
false


-- Tests for luajit_jit_complexity_threshold
-- Check default value
STATEMENT OK
SELECT current_setting('luajit_jit_complexity_threshold');
----
5

STATEMENT OK
SET luajit_jit_complexity_threshold = 10;

STATEMENT OK
SELECT current_setting('luajit_jit_complexity_threshold');
----
10

STATEMENT OK
SET luajit_jit_complexity_threshold = 0;
SELECT current_setting('luajit_jit_complexity_threshold');
----
0

STATEMENT ERROR
SET luajit_jit_complexity_threshold = -1;
----
Binder Error: luajit_jit_complexity_threshold must be non-negative.

STATEMENT ERROR
SET luajit_jit_complexity_threshold = 'abc';
----
Binder Error: SET luajit_jit_complexity_threshold: Could not convert string 'abc' to BIGINT

STATEMENT ERROR
SET GLOBAL luajit_jit_complexity_threshold = 10;
----
Invalid Input Error: Cannot SET GLOBAL luajit_jit_complexity_threshold. This setting is session-local.

-- Test RESET for luajit_jit_complexity_threshold
STATEMENT OK
SET luajit_jit_complexity_threshold = 20; -- Change from default
RESET luajit_jit_complexity_threshold;

STATEMENT OK
SELECT current_setting('luajit_jit_complexity_threshold');
----
5


-- Tests for luajit_jit_trigger_count
-- Check default value
STATEMENT OK
SELECT current_setting('luajit_jit_trigger_count');
----
1000

STATEMENT OK
SET luajit_jit_trigger_count = 500;

STATEMENT OK
SELECT current_setting('luajit_jit_trigger_count');
----
500

STATEMENT OK
SET luajit_jit_trigger_count = 0;
SELECT current_setting('luajit_jit_trigger_count');
----
0

STATEMENT ERROR
SET luajit_jit_trigger_count = -5;
----
Binder Error: luajit_jit_trigger_count must be non-negative.

STATEMENT ERROR
SET luajit_jit_trigger_count = 'xyz';
----
Binder Error: SET luajit_jit_trigger_count: Could not convert string 'xyz' to BIGINT

STATEMENT ERROR
SET GLOBAL luajit_jit_trigger_count = 200;
----
Invalid Input Error: Cannot SET GLOBAL luajit_jit_trigger_count. This setting is session-local.

-- Test RESET for luajit_jit_trigger_count
STATEMENT OK
SET luajit_jit_trigger_count = 2000; -- Change from default
RESET luajit_jit_trigger_count;

STATEMENT OK
SELECT current_setting('luajit_jit_trigger_count');
----
1000
